<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8" />
<!-- 기본 임폴트 css 파일 -->
<link rel="stylesheet" type="text/css" href="/magic-deal/semantic/semantic.min.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/global.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/header.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/nav.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/chat.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/view.css">
<link rel="shortcut icon" href="/magic-deal/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="/magic-deal/img/favicon.ico" type="image/x-icon">
<title>Magic Deal</title>
<!-- 기본 임폴트 css 파일 끝-->

<link rel="stylesheet" type="text/css" href="/magic-deal/css/profileTab.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/activityTab.css">

<style>
.scrollWrap {
	width: 100%;
	min-height: 100%;
	height: 100%;
	padding-top: 70px;
	overflow: auto;
	background-color: #fbfbfb;
}

section {
	width: 100%;
	min-height: 95%; 
	padding-top : 50px;
	padding-bottom: 20px;
	padding-top: 50px;
}

.contentBox {
	margin: 0px auto;
	width: 800px;
	position: relative;
}

.horizontal-tab {
	width: 100%;
	height: 50px;
	background-color: #f9f9f9;
	font-size: 0px;
	line-height: 0px;
	margin-bottom: 10px;
	box-shadow: 2px 2px 8px #999;
}

.tab-title {
	width: 50%;
	height: 50px;
	display: inline-block;
	text-align: center;
	font-size: 14px;
	line-height: 50px;
	cursor: pointer;
}

.tab-title:nth-child(2) {
	border-left: 1px solid #d8d8d8;
}

.tab-title:hover {
	background-color: #fff;
}

.tab-content-box {
	width: 100%; 
	box-shadow : 2px 2px 8px #999;
	border-radius: 4px;
	background-color: #f9f9f9;
	position: relative;
}

.selectBox {
	outline: none;
	font-size: 12px;
	border-radius: 3px;
	padding: 7px;
	margin-right: 5px;
	border: 1px solid #888;
	width: 130px;
}

footer {
	width: 100%;
	height: 50px;
	background: #222;
	line-height: 50px;
	text-align: center;
	color: white;
	font-size : 12px;
	font-weight: 600;
}

#mypageProfileJoinDate::before{
	content : "Joined in ";
}

#mypageProfileLikeCount::after{
	content : " likes";
}

.trickFileBox {
	position : absolute;
	top : 0px;
	left : 50px;
	width : 150px;
	height : 35px;
	opacity : 0;
}

.trickFileWrap {
	position : relative;
	text-align : center;
}

.ui.modal.profileModal {
	width : 500px;
	margin-left : -250px;
	text-align : left;
	background-color : rgba(50,50,50,0.8);
	z-index : 2;
}

.ui.modal.profileModal>.header {
	background-color : rgba(50,50,50,0.8);
	color : white;
}

.ui.modal.profileModal>.footer {
	background-color : rgba(50,50,50,0.8);
	color : white;
}

.ui.modal.profileModal>.content>label {
	display : block;
	margin : 10px 0px 5px 0px;
	font-weight : bold;
}


.ui.modal.infoModal {
	width: 500px;
    margin-left: -250px;
	text-align : left;
	background-color : rgba(50,50,50,0.8);
	z-index : 2;
}

.ui.modal.infoModal>.header {
	background-color : rgba(50,50,50,0.8);
	color : white;
}

.ui.modal.infoModal>.footer {
	background-color : rgba(50,50,50,0.8);
	color : white;
}

.ui.modal.infoModal>.content>label {
	display : block;
	margin : 10px 0px 5px 0px;
	font-weight : bold;
}

.activity-paging {
	width : 100%;
	height : 30px;
	background-color : #fbfbfb;
	line-height : 30px;
	text-align : center;
}

.activity-paging>.pageBtn.currPage {
	font-weight : 800;
	cursor : default;
	background-color : #a333c8;
	color : white;
}

.infoTextArea {
	width : 450px;
	height : 320px;
	border-radius : 5px;
	border : 1px solid #d8d8d8;
	background-color : fafafa;
	outline : none;
	resize : none;
	padding : 5px;
	font-size : 12px;
}

.myPageIdxBox {
	cursor : pointer;
	display : inline-block;
	width : 25px;
	min-height : 25px;
	margin : 0px 2px 0px 2px;
	background-color : #222;
	border-radius : 2px;
	color : white;
	font-weight : 600;
	font-size : 12px;
	line-height : 25px;
}

.myPageCurrPage {
	cursor : default;
	background-color : #ff851b;
}

.myPageArrowBox {
	cursor : pointer;
	display : inline-block;
	width : 25px;
	height : 25px;
	margin : 0px 2px 0px 2px;
	font-weight : 600;
	font-size : 12px;
	line-height : 25px;
	
}
</style>
</head>
<body>

<!-- 헤더부 -->
<!-- 헤더부 -->
<header>
	<div id="loginStatusWrap">
		<!-- 로그인 관련 내용 헤더 -->
	</div>
	<div id="headerLogo">
		<img src="../img/fontlogo.png"/>
	</div>
</header>
<!-- 헤더끝 -->
<!-- 헤더끝 -->

<!-- 네비게이션 -->
<div id="navBtn" class="ui icon button small black">
	<i class="sidebar icon"></i>
</div>
<nav class="ui vertical menu">
	<a id="navMainDirectBtn" class="item">
      <i class="home yellow large icon"></i>메인
    </a>
    <a id="navProductRegistBtn" class="item">
      <i class="cubes yellow large icon"></i>물품등록
    </a>
    <a id="navMapSearchBtn" class="item">
      <i class="marker yellow large icon"></i>지도검색
    </a>
    <a id="navChartSearchBtn" class="item">
      <i class="area chart yellow large icon"></i>차트검색
    </a>
    <a id="navBoardDirectBtn" class="item">
      <i class="info circle large yellow icon"></i>커뮤니티
    </a>
</nav>
<!-- 네비게이션 끝 -->

<div class="scrollWrap">
	<section>
		<div class="contentBox">
			
			<!-- 마이페이지 내용부 -->
				<div class="horizontal-tab">
					<span id="profileTabBtn" class="tab-title"
						style="background-color: #fff;"> 
						<i class="user brown icon"></i>프로필
					</span> 
					<span id="activityTabBtn" class="tab-title"> 
						<i class="quote left teal icon"></i>활동 관리
					</span> 
				</div>

				<div class="tab-content-box">
					<div id="profile-tab-box">
						<div class="profileImg">
							<div class="ui centered special card">
								<div class="blurring dimmable image">
									<div class="ui dimmer">
										<div class="content">
											<div id="profilePhotoBtnBox" class="center">
												
											</div>
										</div>
									</div>
									<img id="mypageProfieImg" src="../img/default/image.png">
								</div>
								<div class="content">
									<a id="mypageProfileNickName" class="header"></a>
									<div class="meta">
										<span id="mypageProfileJoinDate" class="date"></span>
									</div>
								</div>
								<div class="extra content">
									<i class="heart red icon"></i> 
									<span id="mypageProfileLikeCount"></span>
								</div>
							</div>
								<div id="profileUpdateBtnBox">
								</div>
						</div>

						<div class="profileInfo">
							<div class="ui top attached tabular menu">
								<div class="item" id="mypageProfileUpdate">
									<b>자기소개</b>
								</div>
							</div>
								<div id="infoUpdateBtnBox">
								</div>
							<div class="ui bottom attached active tab segment" id="mypageProfileInfo">
							</div>
						</div>
					</div>

					<div id="activity-tab-box" style="display: none">
						<div class="activity-search-bar">
							<label>구매</label>&nbsp;&nbsp;&nbsp;
							<div class="ui toggle checkbox">
							  <input type="checkbox" name="public" checked id="dealStepHigh">
							 <label>판매</label>
							</div>

							<div class="ui action small input">
								<input type="text" placeholder="키워드를 입력하세요!"
									style="width: 350px; margin-left: 20px;" id="searchKeyword"/>
								<button class="ui small brown right labeled icon button" id="searchButton">
									<i class="search icon"></i> 검색
								</button>
							</div>
						</div>

						<div class="activity-content" id="productListBox">
						</div>

						<div class="activity-paging" id="productListPagingBox">
						</div>
					</div>

				</div>

				<!-- 마이페이지 내용부 끝-->
			
		</div>
	</section>
	
	<footer>
		© 2016 Respond404 // republic of korea
	</footer>
</div>

<!-- 헤더 관련 팝업 모달 -->
<!-- 로그인 모달 -->
<div class="ui modal loginModal">
  <i class="close icon" id="loginCloseBtn" onclick="loginClose();"></i>
  <div class="header">
    	로그인 및 회원가입
  </div>
  <div class="content" style="text-align:center;">
        <div class="ui small left icon input" style="margin-bottom:15px;">
			<input type="text" id="loginId" placeholder="아이디를 입력하세요"/>
			<i class="user icon"></i>
		</div>
		<div class="ui small left icon input">
			<input type="password" id="loginPass" placeholder="비밀번호를 입력하세요"/>
			<i class="privacy icon"></i>
		</div>
  </div>
  <div class="actions">
    <div class="ui ok orange button">
      Sign up
    </div>
    <div class="ui teal deny icon button">
      Log in
      <i class="sign in icon"></i>
    </div>
  </div>
</div>
<!-- 로그인 모달 끝 -->

<!-- 회원가입 모달 -->
<div class="ui modal signUpModal">
  <div id="signUpHeader" class="header">
	  <i class="large icons">
		  <i class="user icon"></i>
		  <i class="add corner orange icon"></i>
	  </i>
  	Welcome Magic Deal !!!
  </div>
  <div class="content">
	<label>아이디
       <span style="font-size:12px; color:#444">
         (영문, 숫자 혼합 8자리 이상)
       </span>
     </label>
     <div class="ui small input">
		<input type="text" id="signId" style="width:150px;"/>&nbsp;
		<span id="signIdChkResult">아이디를 입력하세요!</span>
	</div>
      <label>비밀번호
         <span style="font-size:12px; color:#444">
           (숫자, 특수문자 포함 8자 이상)
         </span>
       </label>
       <div class="ui small input">
 			<input type="password" id="signPass" style="width:200px;"/>
	</div>

       <label>비밀번호 확인</label>
       <div class="ui small input">
 			<input type="password" id="signPassChk" style="width:200px;"/>
	</div>

       <label>닉네임</label>
       <div class="ui small input">
 			<input type="text" id="signNickName" style="width:150px;"/> &nbsp;
		<span id="signNickChkResult">닉네임을 입력하세요!</span>
	</div>
	
	<label>주소</label>
       <div class="ui small input">
 			<input type="text" id="signAddr" style="width:350px;" readonly/>&nbsp;
 			<button class="ui orange button" onclick="execDaumPostcode()">주소검색</button>
 			<input type="hidden" id="signLat" value=""/>
 			<input type="hidden" id="signLon" value=""/>
	</div>
	<div id="popupLayer" style="display:none;border:1px solid;width:100%;height:300px;margin:5px 0;position:relative">
	<img src="http://i1.daumcdn.net/localimg/localimages/07/postcode/320/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
	</div>
  </div>
  <div id="signUpFooter" class="actions">
  	<button class="ui red deny inverted icon button" id="signUpCloseBtn">
  		<i class="close icon"></i> 닫기
  	</button>
    <button class="ui violet ok inverted right labeled icon button" onclick="signUpSubmitChk();">
      	회원가입
      <i class="sign in icon"></i>
    </button>
  </div>
</div>
<!-- 회원가입 모달 끝 -->

<!-- 알림창 모달 -->
<div class="ui modal alertModal">
  <i class="close icon"></i>
  <div class="header">
    	알림
  </div>
  <div id="alertMsg" class="content" style="text-align:center;">
        
  </div>
  <div class="actions">
     <div id="alertBtn" class="ui ok right grey labeled icon button">
    </div>
  </div>
</div>
<!-- 알림창 모달 끝 -->


<!-- 프로필 업데이트 모달 -->
			<div id="profileUpdateModal" class="ui modal profileModal">
			    <i class="close icon" id="updateCloseBtn" onclick="updateClose()"></i>
			    <div class="header">
			      	프로필 수정
			    </div>
			    <div class="content">
		<label>닉네임</label>
	       <div class="ui small input">
	 			<input type="text" id="signNickName2" style="width:150px;"/> &nbsp;
			<span id="signNickChkResult2" style="margin-top:10px">변경할 닉네임을 입력하세요!</span>
			</div>
      <label>비밀번호
         <span style="font-size:12px; color:#444">
           (숫자, 특수문자 포함 8자 이상)
         </span>
       </label>
       <div class="ui small input">
 			<input type="password" id="signPass2" style="width:200px;"/>&nbsp;
 				<span style="margin-top:10px">현재 혹은 변경할 비밀번호를 입력하세요!</span>
	</div>

       <label>비밀번호 확인</label>
       <div class="ui small input">
 			<input type="password" id="signPassChk2" style="width:200px;"/>
	</div>

	<label>주소</label>
       <div class="ui small input">
 			<input type="text" id="signAddr2" style="width:350px;" readonly/>&nbsp;
 			<button class="ui orange button" onclick="profile_execDaumPostcode()">주소검색</button>
 			<input type="hidden" id="signLat2" value=""/>
 			<input type="hidden" id="signLon2" value=""/>
	</div>
	<div id="popupLayer2" style="display:none;border:1px solid;width:100%;height:300px;margin:5px 0;position:relative">
	<img src="http://i1.daumcdn.net/localimg/localimages/07/postcode/320/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode(2)" alt="접기 버튼">
	</div>
			    </div>
			    <div class="actions footer">
			      <div class="ui red deny inverted icon button" onclick="updateClose()">
			        <i class="remove icon"></i> 취소
			      </div>
			      <div class="ui green ok inverted right labeled icon button">
			        <i class="checkmark icon"></i> 수정 완료
			      </div>
			    </div>
			  </div>
 <!-- 프로필 업데이트 모달 끝 -->

<!-- 소개 업데이트 모달 -->
			<div id="infoUpdateModal" class="ui modal infoModal">
			    <i class="close icon" id="infoCloseBtn"></i>
			    <div class="header">
			      	자기소개 수정
			    </div>
			    <div class="content">
		<label>자기소개</label>
	       <div class="ui small input">
	       <textarea id="infoContent" class="infoTextArea"></textarea>
			</div>

			    </div>
			    <div class="actions footer">
			      <div class="ui red deny inverted icon button">
			        <i class="remove icon"></i> 취소
			      </div>
			      <div class="ui green ok inverted right labeled icon button">
			        <i class="checkmark icon"></i> 수정 완료
			      </div>
			    </div>
			  </div>
 <!-- 소개 업데이트 모달 끝 -->
 
 
 <!-- 채팅 관련 엘리먼트 -->

<div class="chat-chatBoxWrap">
	<div class="chat-chatInfoBox">
		<div class="circularBox"></div>
		<span id="chat-chatBoxNick"></span>
		<div class="chat-chatBoxCloseBtn">
			<i class="close icon"></i>
		</div>	
	</div>
	<div class="chat-chatBox">
		<div class="chat-msgWrap">
		</div>
	</div>
	<div class="chat-inputBox">
		<input type="text" id="chat-inputText" placeholder="보낼 내용을 입력하세요"/>
		<button class="chat-sendBtn">SEND</button>
	</div>
</div>

<div class="chat-chatListBoxWrap">
	<div class="chat-chatListHeader">
		총 
		<span id="chatList-count"></span>
		개 대화
		
		<div class="chat-chatListCloseBtn">
			<i class="close icon"></i>
		</div>		
	</div>
	<div class="chat-chatListBox">
	</div>
</div>

<div class="chat-chatNoticeBox">
	<div class="chat-chatNoticePhoto">
		<img style="width:100%; height:100%;"/>
	</div>
	<div class="chat-chatNoticeInfo">
	
	</div>
</div>

<!-- 채팅 관련 엘리먼트 끝 -->


<!-- 물품 삭제 모달 -->
<div class="ui basic modal" id="deleteModal">
  <i class="close icon" id="deleteCloseBtn"></i>
  <div class="header">
    	물품 삭제
  </div>
  <div class="image content">
    <div class="image">
      <i class="archive icon"></i>
    </div>
    <div class="description">
      <p>해당 품목의 사진,댓글,정보를 모두 삭제합니다</p>
      <p>해당 품목을 정말 삭제하시겠습니까?</p>
    </div>
  </div>
  <div class="actions">
    <div class="two fluid ui inverted buttons">
      <div class="ui red basic inverted deny button">
        <i class="remove icon"></i>
        No
      </div>
      <div class="ui green ok basic inverted button">
        <i class="checkmark icon"></i>
        Yes
      </div>
    </div>
  </div>
</div>
<!-- 물품 삭제 모달 끝 -->

<!-- 상세보기 모달 시작 -->
<div class="viewItemWrap">
	
	<div class="view-scrollUpBtn ui icon inverted button">
		<i class="angle double up large icon"></i>
	</div>
	<div id="viewLoadingWrap">
		<div class="sk-folding-cube">
			<div class="sk-cube1 sk-cube"></div>
			<div class="sk-cube2 sk-cube"></div>
			<div class="sk-cube4 sk-cube"></div>
			<div class="sk-cube3 sk-cube"></div>
		</div>
	</div>
</div>



<div class="viewItemPaddingBox" id="viewItemCloneBox">
	<div class="viewItemBox">
		<div class="viewItemHeader">
			<div class="viewItemPhotoBox">
				<div id="currentViewPhoto">
				</div>
				<div class="thumbImgBox">
					<div class="thumbFocus">
					</div>
				</div>
			</div>
			<div class="viewItemContent">
				<div class="itemInfo">
					<div class="view-infoHeader view-inforHeader-share">
						PRODUCT INFO <span class="view-annotation">상품정보</span>
						<div class="view-sharedBtnBox">
							<button class='view-shareBtn facebook_btn'></button>
							<button class='view-shareBtn twitter_btn'></button>
							<button class='view-shareBtn kakao_btn'></button>
							<button class='view-shareBtn kakaostory_btn'></button>
							<button class='view-shareBtn url_btn'>URL</button>
						</div>
					</div>
				</div>
				<div class="itemWriter">
					<div class="view-infoHeader">
						MEMBER INFO <span class="view-annotation">등록회원 정보</span>
					</div>
					<div class="view-memberCard">
						<div class="view-memberCardImg"></div>
						<div class="view-memberCardInfo">
							<div class="view-card-nick">
							</div>
							<div class="view-card-active">
								<div class="ui horizontal statistic">
								  <div class="value">
								  </div>
								  <div class="label">
								    Items
								  </div>
								</div>
							</div>
							<div id="view-chatBtn" class="ui purple small button view-memberCardInfo-chatBtn">
								채팅하기
							</div>
						</div>
					</div>
				</div>
				<div class="itemContent">
					<div class="view-infoHeader">
						DETAIL INFO <span class="view-annotation">상세 정보</span>
					</div>
					<div class="view-itemContent">
					</div>
				</div>
			</div>
		</div>
		<div class="viewItemReply">
			<div class="view-regReplyBox">
				<div class="view-infoHeader">
					COMMENT WRITE <span class="view-annotation">댓글 작성</span>
				</div>
				<div class="view-regReplyForm">
					<table>
						<tr>
							<td><textarea id="view-commentContent"></textarea></td>
							<td style="vertical-align:top;">
								<button id="view-commentRegBtn" class="ui black small button">등 록</button>
							</td>
						</tr>
					</table>
				</div>
			</div>
			<div class="view-regReplyContextBox ui comments">
			<!-- 댓글 내용부 -->
				
			<!-- 댓글 내용부 끝 -->
			</div>
			<div class="view-commentPagingBox">
				
			</div>
		</div>
	</div>
	<div class="viewCloseBtn">
		<i class="inverted large close icon"></i>
	</div>
</div>
<!-- 상세보기 모달 끝 -->


<!-- 헤더 관련 팝업 모달 끝-->

<!-- 기본 임폴트 js -->
<script type="text/javascript" src="../lib/jquery/jquery.js"></script>
<!-- 파일 업로드 -->
<script src="../lib/blueimp-file-upload/js/vendor/jquery.ui.widget.js"></script>
<script src="../lib/blueimp-file-upload/js/jquery.iframe-transport.js"></script>
<script src="../lib/blueimp-file-upload/js/jquery.fileupload.js"></script>
<!-- 파일 업로드 끝 -->
<script src="/magic-deal/semantic/semantic.min.js"></script>
<script src="/magic-deal/custom_lib/jquery.nicescroll.js"></script>
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
<script type="text/javascript" src="http://apis.daum.net/maps/maps3.js?apikey=f395cc95b7a2033371e67babc4b49930&libraries=services"></script>
<script src="/magic-deal/js/common.js"></script>
<script src="/magic-deal/js/view.js"></script>
<script src="/magic-deal/js/socket.io.js"></script>
<script src="/magic-deal/js/chat.js"></script> 
<!-- 기본 임폴트 js -->

<script>
	var pageParam;
	var nickName;
	var mlat;
	var mlon;
	var pageSize = 6;
	var productData;
	var ownerNo;
	var mNo;
	 var toggle = "s";
	 var keyword = "";
	
	var loginCheck = function() {
		$.getJSON(contextPath + "/member/loginCheck.do", function(resultObj) {
			if(resultObj.ajaxResult.data!=null){
			nickName = resultObj.ajaxResult.data.nickName;
			mlat = resultObj.ajaxResult.data.mLat;
			mlon = resultObj.ajaxResult.data.mLon;
			mNo = resultObj.ajaxResult.data.mNo;
			}
			var result = resultObj.ajaxResult;

			// 물품 가져오기 끝
			// 채팅서버 연결
			if(result.data!=null)
				chatConnect(result.data);
			
			loginBoxDraw(result.data);
			if(result.data&&result.data.id==pageParam.ow) {
				// 로그인한 사용자가 마이페이지 주인
				console.dir("result.data : "+result.data);
				mypageDraw(result.data, 0);
				ownerNo = result.data.mNo;
			} else if(pageParam.ow){
				$.post(contextPath + "/member/ownerinfo.do", {
					id : pageParam.ow
				}, function(resultObj) {
					var getData = resultObj.ajaxResult;
					console.dir("getData.data : "+getData.data);
					console.dir(getData.data);
					ownerNo = getData.data.mNo;
					if(result.data) mypageDraw(getData.data, 1);
					else mypageDraw(getData.data, 2);
				},"json");
			} else {
				// 비 정상적인 접근
				document.location.href = contextPath + "/page/main.html";
			}
		});
	};
	
	var mypageDraw = function(u_info, flag) {
		var proImg = new Image;
		proImg.onload = function() {
			var width = parseInt($("#mypageProfieImg").parent().css("width"));
			var height = parseInt($("#mypageProfieImg").parent().css("height"));
			var imgBox = $("#mypageProfieImg");
			var iWidth = this.width;
    		var iHeight = this.height;
    		if(iWidth > iHeight) {
    			var translateVal = width / iWidth;
    			var translateHeight = iHeight * translateVal;
    			var margin = Math.floor((height-translateHeight)/2);
    			
    			console.log(width, height, iWidth, iHeight, translateHeight);
    			imgBox.css({
    				width : width,
    				height : "auto",
    				"margin-top" : margin
    			});
    		}else {
    			var translateVal = height / iHeight;
    			var translateWidth = iWidth * translateVal;
    			var margin = Math.floor((width-translateWidth)/2);
    			imgBox.css({
    				width : "auto",
    				height : height,
    				"margin-left" : margin
    			});
    		}
			
			$("#mypageProfieImg").attr("src", contextPath+"/upload/profile/mp_"+u_info.mPhoto);
		};
		proImg.src = contextPath+"/upload/profile/mp_"+u_info.mPhoto;
		$("#mypageProfileNickName").text(u_info.nickName);
		$("#mypageProfileJoinDate").text(u_info.joinDate);
		$("#mypageProfileLikeCount").text(u_info.likeCnt);
		$("#mypageProfileInfo").html(u_info.mInfo);
		
		
		var btnObj;
		var btnObj2;
		var btnObj3;
		if(flag==0) {
			// 자기 자신의 마이페이지일 경우
			btnObj = '<div class="trickFileWrap">';
			btnObj += '<div class="ui inverted teal icon button">';
			btnObj += '<i class="user icon"></i>&nbsp;&nbsp;';
			btnObj += '프로필 사진 수정';
			btnObj += '</div>';
			btnObj += '<input type="file" id="profilePhotoFile" name="file" class="trickFileBox"/>';
			btnObj += '</div>';
	
			$("#profilePhotoBtnBox").html(btnObj);
			
			$("#profilePhotoFile").on("click", function() {
				$(".blurring.dimmable.image").trigger("mouseout");
			});
			
			$("#profilePhotoFile").fileupload({
				url: contextPath + '/member/auth/profilephoto.do',
				dataType: 'json',
				singleFileUploads: false, 
				add: function (e, data) {
			    console.log("파일을 추가하였음...");
			    var uploadFile = data.files[0];
		        var isValid = true;
		        if (!(/png|jpe?g/i).test(uploadFile.name)) {
		            alertMsg('png, jpg 만 가능합니다', "확인");
		            isValid = false;
		        } else if (uploadFile.size > 2000000) { // 2mb
		        	alertMsg('사진의 용량은 2메가를 초과할 수 없습니다.', "확인");
		            isValid = false;
		        }
		        if (isValid) {
		        	data.formData = {
			    		id: u_info.id
			    	};
		            data.submit();  
		            editProfilePhoto(uploadFile);
		        }
			  },
			  done: function (e, data) {
				  console.log("profile img 변경");
			  }
			});
			
			
			// 마이페이지 수정 파트
			btnObj2 = '<div class="ui mini icon black button info-update-btn" id="profileUpdate">';
			btnObj2 += '정보 업데이트</div>';
			$("#profileUpdateBtnBox").html(btnObj2);
			
			
			$("#profileUpdate").on("click", function() {
				  $("#signNickName2").val(u_info.nickName);
				  $("#signAddr2").val(u_info.mAddr);
				$('#profileUpdateModal').modal({
					closable : false,
					onDeny : function(){
						return true;
					},
					onApprove : function(){
						var updateFlag = updateSubmitChk();
						console.log("updateFlag 상태 : "+updateFlag);
						updateCommit(updateFlag);
						return false;
					}
				}).modal('show');
				
			});
			btnObj3 = '<div class="ui mini icon green button info-update-btn" id="infoModal" style="float:right;margin-top:-34px;">';
			btnObj3 += '수정</div>';
			$("#infoUpdateBtnBox").html(btnObj3);
			
			// 자기소개 수정 modal창 클릭 이벤트
			$("#infoModal").on("click", function() {
				 var replacement = replaceAll(u_info.mInfo, '<br/>', '\n');
				 $("#infoContent").val(replacement);
				$('#infoUpdateModal').modal({
					closable : false,
					onDeny : function(){
						return true;
					},
					onApprove : function(){
						infoUpdate();
						return false;
					}
				}).modal('show');
				
			});
			
		}else if(flag==1){
			// 타인의 마이페이지일 경우
			btnObj = '<div class="ui inverted red icon button" onclick="likeCountInc();">';
			btnObj += '<i class="heart icon"></i>&nbsp;&nbsp;';
			btnObj += 'LIKE</div>';
			$("#profilePhotoBtnBox").html(btnObj);
		}else {
			// 비 로그인 상태
		}
	};
	
	var editProfilePhoto = function(uploadFile) {
		var fileReader = new FileReader();
		fileReader.onload = function() {
			var dataURL = fileReader.result;
			
			var proImg = new Image;
			proImg.onload = function() {
				var width = parseInt($("#mypageProfieImg").parent().css("width"));
				var height = parseInt($("#mypageProfieImg").parent().css("height"));
				var imgBox = $("#mypageProfieImg");
				imgBox.css("");
				var iWidth = this.width;
	    		var iHeight = this.height;
	    		
	    		if(iWidth > iHeight) {
	    			var translateVal = width / iWidth;
	    			var translateHeight = iHeight * translateVal;
	    			var margin = Math.floor((height-translateHeight)/2);
	    			
	    			imgBox.css({
	    				width : width,
	    				height : "auto",
	    				"margin-top" : margin
	    			});
	    		}else {
	    			var translateVal = height / iHeight;
	    			var translateWidth = iWidth * translateVal;
	    			var margin = Math.floor((width-translateWidth)/2);
	    			imgBox.css({
	    				width : "auto",
	    				height : height,
	    				"margin-left" : margin
	    			});
	    		}
				
				$("#mypageProfieImg").attr("src", dataURL);
			};
			proImg.src = dataURL;
			
			$("#mypageProfieImg").attr("src", dataURL);
			$("#logUserPhoto").attr("src", dataURL);
		};
		fileReader.readAsDataURL(uploadFile);
	};
		
	// mypage 실행부
	pageParam = getParameter(document.location.href);
	
	loginCheck();
	
	$(".scrollWrap").niceScroll();
	
	$('.special.card .image').dimmer({
		on: 'hover'
	});
	
	//profile-tab-box
	//activity-tab-box
	//alarm-tab-box
	$("#profileTabBtn").click(function() {
		$(".tab-title").css("background-color","#f9f9f9");
		$(this).css("background-color", "#fff");
		$("#activity-tab-box").css("display", "none");
		$("#alarm-tab-box").css("display", "none");
		$("#profile-tab-box").css("display", "block");
	});
	
	$("#activityTabBtn").click(function() {
		$(".tab-title").css("background-color","#f9f9f9");
		$(this).css("background-color", "#fff");
		$("#alarm-tab-box").css("display", "none");
		$("#profile-tab-box").css("display", "none");
		$("#activity-tab-box").css("display", "block");
		$("#searchKeyword").val("");
		$("#dealStepHigh").prop("checked", true);
		toggle = "s";
		keyword = "";
		getMyList(1);
	});
	
	$("#alarmTabBtn").click(function() {
		$(".tab-title").css("background-color","#f9f9f9");
		$(this).css("background-color", "#fff");
		$("#activity-tab-box").css("display", "none");
		$("#profile-tab-box").css("display", "none");
		$("#alarm-tab-box").css("display", "block");
	});
	
	// 프로필 수정 닉네임 중복 확인
	$("#signNickName2").on("keyup", function() {
		var chkNick2 = $(this).val();
		if(chkNick2.trim().length<2) {
			$("#signNickChkResult2").text("닉네임은 2글자 이상입니다.");
			$("#signNickChkResult2").css("color", "#db2828");
			updateChkObj.nick = false;
		}else {
			$.getJSON(
				"http://"+ip+":"+port+"/magic-deal/checkNick?chkNick="+chkNick2+"&callback=?", 
				function(resultData) {
				var result = resultData.result;
				console.log(chkNick2);
				if(result == 'ok') {
					$("#signNickChkResult2").text("사용 가능한 닉네임 입니다.");
					$("#signNickChkResult2").css("color", "#21ba45");
					updateChkObj.nick = true;
				}
 				else if(chkNick2==nickName){
 					$("#signNickChkResult2").text("현재 사용자의 닉네임입니다.");
 					$("#signNickChkResult2").css("color", "#379DBF");
 					updateChkObj.nick = true;
 				}
				else {
					$("#signNickChkResult2").text("이미 사용중인 닉네임 입니다.");				
					$("#signNickChkResult2").css("color", "#db2828");
					updateChkObj.nick = false;
				}
			});
		}
	});
	
	// 프로필 정보 수정 Commit
	var updateCommit = function(flag) {
		if(flag) {
			var nick = $("#signNickName2").val();
			var pass = $("#signPass2").val();
			var addr = $("#signAddr2").val();
			var lat = $("#signLat2").val();
			var lon = $("#signLon2").val();
			if(lat.length==0&&lon.length==0){
				lat = mlat;
				lon = mlon;
			}
			$.post(contextPath+"/member/auth/profileUpdate.do", {
				nickName : nick,
				password : pass,
				mAddr : addr,
				mLat : lat,
				mLon : lon
			}, function(result) {
				console.log(result.ajaxResult);
				var result = result.ajaxResult;
				console.log(result.msg);
				if(result.msg == 'success') {
					infoSuccessMsg("프로필 정보가<br/>성공적으로 변경되었습니다!", "확인");
				}
			}, "json");
		}
	};
	
	// 자기 소개 변경 완료시 Alert 창
	var infoSuccessMsg = function(msg, btn) {
		$("#alertMsg").html(msg);
		$("#alertBtn").html(btn);
		$(".ui.modal.alertModal").modal( {
			allowMultiple : true,
			closable : false,
			onApprove : function() {
				$("#infoCloseBtn").trigger("click");
				location.reload(true);
				return true;
			}
		}).modal('show');
	};
	
	// 프로필 변경 완료시 Alert 창
	var updateSuccessMsg = function(msg, btn) {
		$("#alertMsg").html(msg);
		$("#alertBtn").html(btn);
		$(".ui.modal.alertModal").modal( {
			allowMultiple : true,
			closable : false,
			onApprove : function() {
				$("#updateCloseBtn").trigger("click");
				location.reload(true);
				return true;
			}
		}).modal('show');
	};
	
	// 자기 소개 변경 함수
	var infoUpdate = function() {
		var info = $("#infoContent").val();
		console.log(info);
		$.post(contextPath + "/member/auth/infoupdate.do", {
			mInfo : info
		},function(result){
			console.log(result.ajaxResult);
			var result = result.ajaxResult;
			console.log(result.msg);
			if(result.msg == 'success') {
				updateSuccessMsg("자기소개가<br/>성공적으로 변경되었습니다!", "확인");
			}
		},"json");
		
		return false;
	};
	
	// 프로필 업데이트 창 닫기
	var updateClose = function() {
		$("#signNickName2").val("");
		$("#signPass2").val("");
		$("#signPassChk2").val("");
		$("#signAddr2").val("");
		$("#signLat2").val("");
		$("#signLon2").val("");
	};
	
    var element_wrap = document.getElementById('popupLayer2');

    function foldDaumPostcode() {
        // iframe을 넣은 element를 안보이게 한다.
        element_wrap.style.display = 'none';
    }

    function profile_execDaumPostcode() {
        // 현재 scroll 위치를 저장해놓는다.
        var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
        new daum.Postcode({
            oncomplete: function(data) {
                // 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var fullAddr = data.address; // 최종 주소 변수
                var extraAddr = ''; // 조합형 주소 변수

                // 기본 주소가 도로명 타입일때 조합한다.
                if(data.addressType === 'R'){
                    //법정동명이 있을 경우 추가한다.
                    if(data.bname !== ''){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있을 경우 추가한다.
                    if(data.buildingName !== ''){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 조합형주소의 유무에 따라 양쪽에 괄호를 추가하여 최종 주소를 만든다.
                    fullAddr += (extraAddr !== '' ? ' ('+ extraAddr +')' : '');
                }

                $("#signAddr2").val(fullAddr);
                var geocoder = new daum.maps.services.Geocoder();
                geocoder.addr2coord(data.address, function(status, result) {
                    // 정상적으로 검색이 완료됐으면
                    if (status === daum.maps.services.Status.OK) {
                        // 해당 주소에 대한 좌표를 받아서
                        var lat = result.addr[0].lat;
                        var lng = result.addr[0].lng;
                        
                        $("#signLat2").val(lat);
                        $("#signLon2").val(lng);
                    }
                });

                // iframe을 넣은 element를 안보이게 한다.
                // (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
                element_wrap.style.display = 'none';
                var topPos = parseInt($(".ui.modal.profileModal").css("top"));
                $(".ui.modal.profileModal").css("top", topPos+150+"px");

                // 우편번호 찾기 화면이 보이기 이전으로 scroll 위치를 되돌린다.
                document.body.scrollTop = currentScroll;
            },
            // 우편번호 찾기 화면 크기가 조정되었을때 실행할 코드를 작성하는 부분. iframe을 넣은 element의 높이값을 조정한다.
            onresize : function(size) {
                element_wrap.style.height = size.height+'px';
            },
            width : '100%',
            height : '100%'
        }).embed(element_wrap);

        // iframe을 넣은 element를 보이게 한다.
        element_wrap.style.display = 'block';
        var topPos = parseInt($(".ui.modal.profileModal").css("top"));
        $(".ui.modal.profileModal").css("top", topPos-150+"px");
    };
    
    // 프로필 비밀번호 변경 유효성 검사
    var passwordChk2 = function() {
    	var pass1 = $("#signPass2").val();
    	var pass2 = $("#signPassChk2").val();
    	if((pass1.length>=6)&&(pass2.length>=6)){
    		if(pass1==pass2){
    			return true;
    		}
    	}
    	return false;
    };
    
    // 프로필 변경 true 확인
    var updateChkObj = {
    		nick : true,
    		password : false,
    		result : function() {
    			return this.nick && this.password;
    		}
    	};
    
    var alertMsg2 = function(msg, btn) {
    	$("#alertMsg").html(msg);
    	$("#alertBtn").html(btn);
    	$(".ui.modal.alertModal").modal( {
    		allowMultiple : true,
    		closable : false,
    		onApprove : function() {
    			return true;
    		}
    	}).modal('show');
    };

    // 프로필 변경 Submit 처리
    var updateSubmitChk = function() {
    	updateChkObj.password = passwordChk2();
    	console.log("nick:"+updateChkObj.nick);
    	console.log("pass:"+updateChkObj.password);
    	if(updateChkObj.result()) {
    		// 폼 검사 적격 회원가입 진행
    		return true;
    	}else {
    		// 폼 검사 부적격
    		alertMsg2("입력이 누락되거나 잘못되었습니다!!", "확인");
    		return false;
    	}
    };
    
 	// 자기소개 모달창 줄바꿈
    function replaceAll(str, target, replacement) {
		return str.split(target).join(replacement);
    };
    
   	$("#dealStepHigh").on("change", function() {
   		if(this.checked) {
   			// 팝니다 물품만
   			console.log("판매1111");
   			toggle = "s";
   		}else {
   			// 삽니다 물품만
   			console.log("구매2222");
   			toggle = "b";
   		}
   		$(".activity-paging").empty();
   		getMyList(1);
   	});
    	
    // 리스트 가져오기
    var getMyList = function(pageNum) {
    	$(".activity-paging").empty();
		var mNo = ownerNo;
		$.getJSON(contextPath + "/product/myList.do", {
				mNo : mNo,
				page : pageNum,
				dealType : toggle,
				key : keyword
			}, function(resultObj) {
				var result = resultObj.ajaxResult;
				console.dir(result);
				drawList(result.data);
				console.log("maxCnt 값 : "+result.data.resultList.maxCnt);
				mypageNumDraw(result.data.resultList.maxCnt, pageNum);
			});
	};
	
	// 카드 뿌리기
	var drawList = function(resultData) {
		$("#productListBox").empty();
		$("#productListPagingBox").empty();
		var lId = resultData.lId;
		var listData = resultData.resultList.productList;
		console.dir(listData);
		console.log(listData.length);
		if(listData.length > 0) {
			for(i=0; i<listData.length; i++) {
				console.dir(listData[i]);
				var data = listData[i];
				var proCard = '<div class="product-card">';
				var labelColor = data.dealStep=='y'?'green':'red';
				var labelStep = data.dealStep=='y'?'대기':'완료';
				proCard += '<a class="ui left corner ';
				proCard += labelColor+' label">';
		 		proCard += '<span style="float:left; font-size:12px; margin-left: 3px; margin-top: 8px;">';
		 		proCard += labelStep+'</span>'
				proCard += '</a>';
				proCard += '<div class="product-card-img" ';
				proCard += 'style="background-image:url(\'';
				proCard += contextPath + '/upload/product/' + data.p_ph_path;
				proCard += '/thum_' + data.p_ph_name;
				proCard += '\');"';
				proCard += '></div>';
				proCard += '<input type="hidden" name="productNo" value="'+data.pNo+'"/>';
				proCard += '<div class="product-card-info">';
				proCard += '<div class="product-card-info-wrap">';
				proCard += '<div class="info-title">';
				proCard += '<span>'+data.pRegDate+'</span>';
				var dealType = data.dealType=='s'?'팝니다':'삽니다';
				proCard += '<span>'+dealType+'</span>';
				proCard += '</div>';
				proCard += '<div class="info-content">';
				proCard += data.cateKeyword;
				proCard += '</div>';
				proCard += '<div class="info-button-box">';
				if(mNo!=null&&mNo==data.mNo) {
					
				proCard +=	'<div class="ui toggle checkbox" style="float:left; margin-left: 5px; margin-top: 10px;">';
				proCard +=	'<input type="checkbox" name="public" id="dealStepLow">';
				proCard +=	'<label>완료</label>';
				proCard +=	'</div>';
				
				proCard += '<button class="ui circular mini icon blue button"';
				proCard += 'title="수정" style="font-size:13px;">';
				proCard += '<i class="edit icon"></i>';
				proCard += '</button>';
				proCard += '<button class="ui circular mini icon red button deleteProduct"';
				proCard += 'title="삭제" style="font-size:13px;" data-pidx="'+data.pNo+'">';
				proCard += '<i class="trash icon"></i>';
				proCard += '</button>';
				}
				proCard += '</div>';
				proCard += '</div>';
				$(proCard).appendTo("#productListBox");
			
				
			}
			
			// 물품 삭제 함수
			$(".deleteProduct").on("click", function() {
				event.stopPropagation();
				var pNo = $(this).attr("data-pidx");
				$(this).parent().parent().parent().parent()
					   .trigger("mouseover");
				$('#deleteModal').modal({
					closable : false,
					onDeny : function(){
						return true;
					},
					onApprove : function(){
						$.getJSON(contextPath + "/product/productDelete.do", {
							pNo : pNo
						}, function(resultObj) {
							moveActivityTap();
						});
						return true;
					}
				}).modal('show');
			});
			
			// 물품 상세정보 함수
			$("#productListBox").on("click", ">.product-card", function() {
				modalOpen($(this).find("input[name=productNo]").val());
			});
			
			$(".product-card").on("mouseover", function() {
	 			$(this).find(".product-card-info")
	 				   .addClass("product-card-info-open");
	 		});
			
			$(".product-card").on("mouseleave", function() {
	 			$(this).find(".product-card-info")
	 				   .removeClass("product-card-info-open");
	 		});
			
			
			$("#dealStepLow").on("change", function() {
				if(this.checked) {
					// 완료
					console.log("완료");
				}else {
					// 대기
					console.log("대기");
				}
			});
			
		}
				
		
	};
	
	$("#searchButton").on("click", function() {
		event.preventDefault();
		keyword = $("#searchKeyword").val();
		if(keyword==""){
			keywordMsg("검색어를 입력하세요!", "확인");
		}
		else{
    		getMyList(1);
		}
	});
	
	var mypageNumDraw = function(maxCnt, currPage) {
		console.log(maxCnt, currPage);
		var pagingBox = $(".activity-paging");
		var maxPage = parseInt((maxCnt-1)/6)+1;
		var currMinPage;
		var currMaxPage;
		var i;
		currPage = parseInt(currPage);
		if(currPage<=5) {
			currMinPage = 1;
			currMaxPage = 10;
			
			if(maxPage < currMaxPage) 
				currMaxPage = maxPage;
		}else if(currPage<=maxPage-5) {
			currMinPage = currPage-4;
			currMaxPage = currPage+5;
		}else {
			currMinPage = maxPage-9;
			currMaxPage = maxPage;
			if(currMinPage < 1) {
				currMinPage = 1;
			}
		}
		
		pagingBox.empty();
		
		var pageIdxBox;
		if(currMinPage>1) {
			pageIdxBox = "<span class='myPageArrowBox' onclick='getMyList(1)'>";
			pageIdxBox += "<i class='angle double left icon'></i>";
			pageIdxBox += "</span>";
			pagingBox.append(pageIdxBox);
		}
		
		for(i=currMinPage; i<=currMaxPage; i++) {
			pageIdxBox = "<span class='myPageIdxBox'>";
			pageIdxBox += i;
			pageIdxBox += "</span>";
			pagingBox.append(pageIdxBox);
		}
		
		if(currMaxPage<maxPage) {
			pageIdxBox = "<span class='myPageArrowBox' onclick='getMyList("+maxPage+")'>";
			pageIdxBox += "<i class='angle double right icon'></i>";
			pageIdxBox += "</span>";
			pagingBox.append(pageIdxBox);
		}
		
		pagingBox.find(".myPageIdxBox").on("click", function() {
			var pageNum = $(this).text();
			getMyList(pageNum);
		}).eq(currPage-currMinPage).addClass("myPageCurrPage").on("click", null);
	};
	
	
	var moveActivityTap = function() {
		setTimeout(function() {
			$("#activityTabBtn").trigger("click");		
		}, 50);
	};
	
	var currentViewTab = function() {
		var url = document.location.href;
		if(url.indexOf("#") != -1) {
			moveActivityTap();
		}
	};
	
	currentViewTab();
</script>
</body>
</html>
