<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8" />
<!-- 기본 임폴트 css 파일 -->
<link rel="stylesheet" type="text/css" href="/magic-deal/semantic/semantic.min.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/global.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/header.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/nav.css">
<!-- 기본 임폴트 css 파일 끝-->

<link rel="stylesheet" type="text/css" href="/magic-deal/css/profileTab.css">
<link rel="stylesheet" type="text/css" href="/magic-deal/css/activityTab.css">

<style>
.scrollWrap {
	width: 100%;
	min-height: 100%;
	height: 100%;
	padding-top: 70px;
	overflow: auto;
	background-color: #ebebeb;
}

section {
	width: 100%;
	min-height: 95%; 
	padding-top : 50px;
	padding-bottom: 20px;
	padding-top: 50px;
}

.contentBox {
	margin: 0px auto;
	width: 800px;
	position: relative;
}

.horizontal-tab {
	width: 100%;
	height: 50px;
	background-color: #f9f9f9;
	font-size: 0px;
	line-height: 0px;
	margin-bottom: 10px;
	box-shadow: 2px 2px 8px #999;
}

.tab-title {
	width: 33.3%;
	height: 50px;
	display: inline-block;
	text-align: center;
	font-size: 14px;
	line-height: 50px;
	cursor: pointer;
}

.tab-title:nth-child(2) {
	border-left: 1px solid #d8d8d8;
	border-right: 1px solid #d8d8d8;
}

.tab-title:hover {
	background-color: #fff;
}

.tab-content-box {
	width: 100%; 
	box-shadow : 2px 2px 8px #999;
	border-radius: 4px;
	background-color: #f9f9f9;
	position: relative;
}

.selectBox {
	outline: none;
	font-size: 12px;
	border-radius: 3px;
	padding: 7px;
	margin-right: 5px;
	border: 1px solid #888;
	width: 130px;
}

footer {
	width: 100%;
	height: 50px;
	background: #242628;
	background: -moz-linear-gradient(top, #242628 0%, #000000 100%);
	background: -webkit-linear-gradient(top, #242628 0%, #000000 100%);
	background: linear-gradient(to bottom, #242628 0%, #000000 100%);
	filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#242628',
		endColorstr='#000000', GradientType=0);
	line-height: 50px;
	text-align: center;
	color: white;
	font-weight: 300;
}

#mypageProfileJoinDate::before{
	content : "Joined in ";
}

#mypageProfileLikeCount::after{
	content : " likes";
}

.trickFileBox {
	position : absolute;
	top : 0px;
	left : 50px;
	width : 150px;
	height : 35px;
	opacity : 0;
}

.trickFileWrap {
	position : relative;
	text-align : center;
}


</style>
</head>
<body>
<!-- 헤더부 -->
<header>
	<div class="ui search">
  		<div class="ui icon input">
    		<input class="prompt" type="text" placeholder="원하는 지역을 검색하세요" style="font-size:12px; width:200px;"/>
   			 <i class="search icon"></i>
  		</div>
  	<div class="results"></div>
	</div>
	<div id="loginStatusWrap">
		<!-- 로그인 관련 내용 헤더 -->
	</div>
	<div id="headerLogo">
		<img src="../img/logo1.png"/>
	</div>
</header>
<!-- 헤더끝 -->

<!-- 네비게이션 -->
<div id="navBtn" class="ui icon button small black">
	<i class="sidebar icon"></i>
</div>
<nav class="ui vertical menu">
	<a id="navMainDirectBtn" class="item">
      <i class="home large orange icon"></i>메인
    </a>
    <a id="navProductRegistBtn" class="item">
      <i class="cubes large orange icon"></i>물품등록
    </a>
    <a id="navBoardDirectBtn" class="item">
      <i class="info circle large orange icon"></i>커뮤니티
    </a>
</nav>
<!-- 네비게이션 끝 -->

<div class="scrollWrap">
	<section>
		<div class="contentBox">
			
			<!-- 마이페이지 내용부 -->
				<div class="horizontal-tab">
					<span id="profileTabBtn" class="tab-title"
						style="background-color: #fff;"> <i class="user brown icon"></i>프로필
					</span> <span id="activityTabBtn" class="tab-title"> <i
						class="quote left teal icon"></i>활동 관리
					</span> <span id="alarmTabBtn" class="tab-title"> <i
						class="alarm red icon"></i>알람 관리
					</span>
				</div>

				<div class="tab-content-box">
					<div id="profile-tab-box">
						<div class="profileImg">
							<div class="ui centered special card">
								<div class="blurring dimmable image">
									<div class="ui dimmer">
										<div class="content">
											<div id="profilePhotoBtnBox" class="center">
												
											</div>
										</div>
									</div>
									<img id="mypageProfieImg" src="../img/default/image.png">
								</div>
								<div class="content">
									<a id="mypageProfileNickName" class="header"></a>
									<div class="meta">
										<span id="mypageProfileJoinDate" class="date"></span>
									</div>
								</div>
								<div class="extra content">
									<i class="heart red icon"></i> 
									<span id="mypageProfileLikeCount"></span>
								</div>
							</div>
							<div class="ui mini icon black button info-update-btn">
								정보 업데이트</div>
						</div>

						<div class="profileInfo">
							<div class="ui top attached tabular menu">
								<div class="item">
									<b>자기소개</b>
								</div>
							</div>
							<div class="ui bottom attached active tab segment">
								<p id="mypageProfileInfo">
									
								</p>
							</div>
						</div>
					</div>

					<div id="activity-tab-box" style="display: none">
						<div class="activity-search-bar">
							<select class="selectBox">
								<option value="">전체물품</option>
								<option value="1">거래대기</option>
								<option value="2">거래완료</option>
							</select>

							<div class="ui action small input">
								<input type="text" placeholder="키워드를 입력하세요!"
									style="width: 350px;" />
								<button class="ui small brown right labeled icon button">
									<i class="search icon"></i> 검색
								</button>
							</div>
						</div>

						<div class="activity-content">
							<div class="product-card">
								<a class="ui left corner red label"> <i class="cube icon"></i>
								</a>
								<div class="product-card-img"
									style="background-image: url('../img/sample-test/test.JPG');">

								</div>
								<div class="product-card-info">
									<div class="product-card-info-wrap">
										<div class="info-title">
											<span>2016. 02. 29</span> <span style="color: #db2828;">거래완료</span>
										</div>
										<div class="info-content">이곳에는 각종 판매에 관련되어 사용자가 등록한 내용이
											들어가게 됩니다.</div>
										<div class="info-button-box">
											<button class="ui circular mini icon inverted olive button"
												title="수정" style="font-size: 13px;">
												<i class="write icon"></i>
											</button>

											<button class="ui circular mini icon inverted red button"
												title="삭제" style="font-size: 13px;">
												<i class="trash icon"></i>
											</button>
										</div>
									</div>
								</div>
							</div>

							<div class="product-card">
								<a class="ui left corner green label"> <i
									class="in cart icon"></i>
								</a>
								<div class="product-card-img"
									style="background-image: url('../img/sample-test/sample2.JPG');">

								</div>
								<div class="product-card-info">
									<div class="product-card-info-wrap">
										<div class="info-title">
											<span>2016. 02. 29</span> <span style="color: #21ba45;">거래대기</span>
										</div>
										<div class="info-content">이곳에는 각종 판매에 관련되어 사용자가 등록한 내용이
											들어가게 됩니다.</div>
										<div class="info-button-box">
											<button class="ui circular mini icon inverted olive button"
												title="수정" style="font-size: 13px;">
												<i class="write icon"></i>
											</button>

											<button class="ui circular mini icon inverted red button"
												title="삭제" style="font-size: 13px;">
												<i class="trash icon"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="activity-paging">
							<a class="ui mini icon button"> <i
								class="angle double left icon"></i>
							</a> <a class="ui mini icon button"> <i class="angle left icon"></i>
							</a> &nbsp;&nbsp;1 &nbsp;&nbsp;2 &nbsp;&nbsp;3 &nbsp;&nbsp;4
							&nbsp;&nbsp;5 &nbsp;&nbsp;6 &nbsp;&nbsp;7 &nbsp;&nbsp;8
							&nbsp;&nbsp;9 &nbsp;&nbsp;10&nbsp;&nbsp; <a
								class="ui mini icon button"> <i
								class="angle double right icon"></i>
							</a> <a class="ui mini icon button"> <i class="angle right icon"></i>
							</a>
						</div>
					</div>

					<div id="alarm-tab-box" style="display: none">
						<div></div>
					</div>
				</div>

				<!-- 마이페이지 내용부 끝-->
			
		</div>
	</section>
	
	<footer>
		© 2016 Respond404 // republic of korea
	</footer>
</div>

<!-- 헤더 관련 팝업 모달 -->
<!-- 로그인 모달 -->
<div class="ui modal loginModal">
  <i class="close icon" id="loginCloseBtn" onclick="loginClose();"></i>
  <div class="header">
    	로그인 및 회원가입
  </div>
  <div class="content" style="text-align:center;">
        <div class="ui small left icon input" style="margin-bottom:15px;">
			<input type="text" id="loginId" placeholder="아이디를 입력하세요"/>
			<i class="user icon"></i>
		</div>
		<div class="ui small left icon input">
			<input type="password" id="loginPass" placeholder="비밀번호를 입력하세요"/>
			<i class="privacy icon"></i>
		</div>
  </div>
  <div class="actions">
    <div class="ui ok orange button">
      Sign up
    </div>
    <div class="ui teal deny icon button">
      Log in
      <i class="sign in icon"></i>
    </div>
  </div>
</div>
<!-- 로그인 모달 끝 -->

<!-- 회원가입 모달 -->
<div class="ui modal signUpModal">
  <div id="signUpHeader" class="header">
	  <i class="large icons">
		  <i class="user icon"></i>
		  <i class="add corner orange icon"></i>
	  </i>
  	Welcome Magic Deal !!!
  </div>
  <div class="content">
	<label>아이디
       <span style="font-size:12px; color:#444">
         (영문, 숫자 혼합 8자리 이상)
       </span>
     </label>
     <div class="ui small input">
		<input type="text" id="signId" style="width:150px;"/>&nbsp;
		<button class="ui button" id="signIdChkBtn">중복검사</button>
	</div>
      <label>비밀번호
         <span style="font-size:12px; color:#444">
           (숫자, 특수문자 포함 8자 이상)
         </span>
       </label>
       <div class="ui small input">
 			<input type="password" id="signPass" style="width:200px;"/>
	</div>

       <label>비밀번호 확인</label>
       <div class="ui small input">
 			<input type="password" id="signPassChk" style="width:200px;"/>
	</div>

       <label>닉네임</label>
       <div class="ui small input">
 			<input type="text" id="signNickName" style="width:150px;"/> &nbsp;
 			<button class="ui button" id="signNickNameBtn">중복검사</button>
	</div>
	
	<label>주소</label>
       <div class="ui small input">
 			<input type="text" id="signAddr" style="width:350px;" readonly/>&nbsp;
 			<button class="ui orange button" onclick="execDaumPostcode()">주소검색</button>
 			<input type="hidden" id="signLat" value=""/>
 			<input type="hidden" id="signLon" value=""/>
	</div>
	<div id="popupLayer" style="display:none;border:1px solid;width:100%;height:300px;margin:5px 0;position:relative">
	<img src="http://i1.daumcdn.net/localimg/localimages/07/postcode/320/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
	</div>
  </div>
  <div id="signUpFooter" class="actions">
  	<button class="ui red deny inverted icon button" id="signUpCloseBtn">
  		<i class="close icon"></i> 닫기
  	</button>
    <button class="ui violet ok inverted right labeled icon button" onclick="signUpSubmitChk();">
      	회원가입
      <i class="sign in icon"></i>
    </button>
  </div>
</div>
<!-- 회원가입 모달 끝 -->

<!-- 알림창 모달 -->
<div class="ui modal alertModal">
  <i class="close icon"></i>
  <div class="header">
    	알림
  </div>
  <div id="alertMsg" class="content" style="text-align:center;">
        
  </div>
  <div class="actions">
     <div id="alertBtn" class="ui ok right grey labeled icon button">
    </div>
  </div>
</div>
<!-- 알림창 모달 끝 -->
<!-- 헤더 관련 팝업 모달 끝-->

<!-- 기본 임폴트 js -->
<script type="text/javascript" src="../lib/jquery/jquery.js"></script>
<!-- 파일 업로드 -->
<script src="../lib/blueimp-file-upload/js/vendor/jquery.ui.widget.js"></script>
<script src="../lib/blueimp-file-upload/js/jquery.iframe-transport.js"></script>
<script src="../lib/blueimp-file-upload/js/jquery.fileupload.js"></script>
<!-- 파일 업로드 끝 -->
<script src="/magic-deal/semantic/semantic.min.js"></script>
<script src="/magic-deal/custom_lib/jquery.nicescroll.js"></script>
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
<script type="text/javascript" src="http://apis.daum.net/maps/maps3.js?apikey=f395cc95b7a2033371e67babc4b49930&libraries=services"></script>
<script src="/magic-deal/js/common.js"></script>
<!-- 기본 임폴트 js -->

<script>
	var pageParam;
	
	var loginCheck = function() {
		$.getJSON(contextPath + "/member/loginCheck.do", function(resultObj) {
			var result = resultObj.ajaxResult;
			loginBoxDraw(result.data);
			console.dir(result.data);
			if(result.data&&result.data.id==pageParam.ow) {
				// 로그인한 사용자가 마이페이지 주인
				mypageDraw(result.data, 0);
			} else if(pageParam.ow){
				$.post(contextPath + "/member/ownerinfo.do", {
					id : pageParam.ow
				}, function(resultObj) {
					var getData = resultObj.ajaxResult;
					if(result.data) mypageDraw(getData.data, 1);
					else mypageDraw(getData.data, 2);
				},"json");
			} else {
				// 비 정상적인 접근
				document.location.href = contextPath + "/page/main.htm";
			}
		});
	};
	
	var mypageDraw = function(u_info, flag) {
		$("#mypageProfieImg").attr("src", contextPath+"/upload/profile/mp_"+u_info.mPhoto);
		$("#mypageProfileNickName").text(u_info.nickName);
		$("#mypageProfileJoinDate").text(u_info.joinDate);
		$("#mypageProfileLikeCount").text(u_info.likeCnt);
		$("#mypageProfileInfo").html(u_info.mInfo);

		var btnObj;
		if(flag==0) {
			// 자기 자신의 마이페이지일 경우
			btnObj = '<div class="trickFileWrap">';
			btnObj += '<div class="ui inverted teal icon button">';
			btnObj += '<i class="user icon"></i>&nbsp;&nbsp;';
			btnObj += '프로필 사진 수정';
			btnObj += '</div>';
			btnObj += '<input type="file" id="profilePhotoFile" name="file" class="trickFileBox"/>';
			btnObj += '</div>';
	
			$("#profilePhotoBtnBox").html(btnObj);
			
			$("#profilePhotoFile").on("click", function() {
				$(".blurring.dimmable.image").trigger("mouseout");
			});
			
			$("#profilePhotoFile").fileupload({
				url: contextPath + '/member/profilephoto.do',
				dataType: 'json',
				singleFileUploads: false, 
				add: function (e, data) {
			    console.log("파일을 추가하였음...");
			    var uploadFile = data.files[0];
		        var isValid = true;
		        if (!(/png|jpe?g/i).test(uploadFile.name)) {
		            alertMsg('png, jpg 만 가능합니다', "확인");
		            isValid = false;
		        } else if (uploadFile.size > 2000000) { // 2mb
		        	alertMsg('사진의 용량은 2메가를 초과할 수 없습니다.', "확인");
		            isValid = false;
		        }
		        if (isValid) {
		        	data.formData = {
			    		id: u_info.id
			    	};
		            data.submit();  
		            editProfilePhoto(uploadFile);
		        }
			  },
			  done: function (e, data) {
				  console.log("profile img 변경");
			  }
			});
			
		}else if(flag==1){
			// 타인의 마이페이지일 경우
			btnObj = '<div class="ui inverted red icon button" onclick="likeCountInc();">';
			btnObj += '<i class="heart icon"></i>&nbsp;&nbsp;';
			btnObj += 'LIKE</div>';
			$("#profilePhotoBtnBox").html(btnObj);
		}else {
			// 비 로그인 상태
		}
	};
	
	var editProfilePhoto = function(uploadFile) {
		var fileReader = new FileReader();
		fileReader.onload = function() {
			var dataURL = fileReader.result;
			$("#mypageProfieImg").attr("src", dataURL);
			$("#logUserPhoto").attr("src", dataURL);
		};
		fileReader.readAsDataURL(uploadFile);
	};
		
	// mypage 실행부
	pageParam = getParameter(document.location.href);
	loginCheck();
	$(".scrollWrap").niceScroll();
	
	$('.special.card .image').dimmer({
		on: 'hover'
	});
	
	$(".product-card").hover(function() {
		$(this).find(".product-card-info")
			   .toggleClass("product-card-info-open");
	});
	
	//profile-tab-box
	//activity-tab-box
	//alarm-tab-box
	$("#profileTabBtn").click(function() {
		$(".tab-title").css("background-color","#f9f9f9");
		$(this).css("background-color", "#fff");
		$("#activity-tab-box").css("display", "none");
		$("#alarm-tab-box").css("display", "none");
		$("#profile-tab-box").css("display", "block");
	});
	
	$("#activityTabBtn").click(function() {
		$(".tab-title").css("background-color","#f9f9f9");
		$(this).css("background-color", "#fff");
		$("#alarm-tab-box").css("display", "none");
		$("#profile-tab-box").css("display", "none");
		$("#activity-tab-box").css("display", "block");
	});
	
	$("#alarmTabBtn").click(function() {
		$(".tab-title").css("background-color","#f9f9f9");
		$(this).css("background-color", "#fff");
		$("#activity-tab-box").css("display", "none");
		$("#profile-tab-box").css("display", "none");
		$("#alarm-tab-box").css("display", "block");
	});
</script>
</body>
</html>
